<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="registeredBook">

  <select id="regiBookListByCategory" parameterType="bossbabies.com.a.parameterVO.SellerAndCategoryVO" resultType="bossbabies.com.a.dto.RegisteredBookDto">
    select rb.registered_book_id, rb.book_id, rb.seller_id, rb.order_count, rb.book_count, rb.register_date, rb.sell_status, 0,
           b.image_url, b.title
    from registered_book rb, book b
    where rb.book_id = b.book_id
    and rb.seller_id = #{sellerId}
    and b.category = #{category}
    and rb.sell_status = #{sellStatus}
  </select>

  <select id="regiBookListBySellCount" parameterType="bossbabies.com.a.parameterVO.SellerAndCategoryVO" resultType="bossbabies.com.a.dto.RegisteredBookDto">
    select rb.registered_book_id, rb.book_id, rb.seller_id, rb.order_count, rb.book_count, rb.register_date, rb.sell_status, 0,
           b.image_url, b.title
    from registered_book rb, book b
    where rb.book_id = b.book_id
    and rb.seller_id = #{sellerId}
    and b.category = #{category}
    and rb.sell_status = #{sellStatus}
    order by order_count desc;
  </select>

  <select id="regiBookListByKeyword" parameterType="bossbabies.com.a.parameterVO.CategoryAndKeywordVO" resultType="bossbabies.com.a.dto.RegisteredBookDto">
    select rb.registered_book_id, rb.book_id, rb.seller_id, rb.order_count, rb.book_count, rb.register_date, rb.sell_status, 0,
           b.image_url, b.title
    from registered_book rb, book b
    where rb.book_id = b.book_id
      and rb.seller_id = #{sellerId}
      and b.category = #{category}
      and rb.sell_status = #{sellStatus}
      and b.title like concat('%', #{keyword}, '%')
  </select>

  <update id="updateBookCountAndDiscount" parameterType="bossbabies.com.a.parameterVO.IdAndCountVO">
    update registered_book
    set book_count = #{newCount}, discount_rate = #{discount}
    where registered_book_id = #{registeredBookId}
  </update>

  <select id="getBooksNotRegistered" parameterType="Integer" resultType="bossbabies.com.a.dto.RegisteredBookDto">
    select rb.registered_book_id, rb.book_id, rb.seller_id, rb.order_count, rb.book_count, rb.register_date, rb.sell_status, 0,
           b.image_url, b.title
    from registered_book rb, book b
    where rb.book_id = b.book_id
      and rb.seller_id = #{sellerId}
      and b.category = #{category}
      and rb.sell_status = 0
  </select>

  <update id="updateSellStatus" parameterType="bossbabies.com.a.parameterVO.StatusAndRegisteredBookIdVO">
    update registered_book
    set sell_status = #{status}
    where registered_book_id = #{registeredBookId}
  </update>

  <update id="updateDeliveryStatus" parameterType="bossbabies.com.a.parameterVO.StatusAndRegisteredBookIdVO">
    update orders
    set delivery_status = #{status}
    where registered_book_id = #{registeredBookId}
  </update>


  <select id="getRegisteredBook" parameterType="java.lang.Integer" resultType="bossbabies.com.a.dto.RegisteredBookDto">
    select rb.registered_book_id, rb.book_id, rb.seller_id, rb.order_count, rb.book_count, rb.register_date, rb.sell_status, rb.discount_rate,
           b.image_url, b.title
    from registered_book rb, book b
    where rb.book_id = b.book_id
    and registered_book_id=#{registered_book_id}
  </select>

</mapper>


